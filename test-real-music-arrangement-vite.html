<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Real Music Arrangement BC Test (Vite)</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            margin-top: 0;
            color: #ffd700;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .track-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }
        
        .collaboration-button {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #333;
        }
        
        .audio-button {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            color: #333;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        input, select {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .track-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .track-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .track-controls {
            display: flex;
            gap: 5px;
        }
        
        .small-button {
            padding: 5px 10px;
            font-size: 12px;
            min-width: auto;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .warning {
            background: rgba(255, 165, 0, 0.2);
            border: 1px solid rgba(255, 165, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .emoji {
            font-size: 1.2em;
            margin-right: 8px;
        }
        
        .instructions {
            background: rgba(0, 123, 255, 0.2);
            border: 1px solid rgba(0, 123, 255, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ Real Music Arrangement BC Test (Vite)</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ ä½¿ç”¨èªªæ˜</h3>
            <p><strong>é‡è¦ï¼š</strong>é€™å€‹é é¢éœ€è¦åœ¨ Vite é–‹ç™¼ä¼ºæœå™¨ä¸­é‹è¡Œæ‰èƒ½æ­£ç¢ºè¼‰å…¥ TypeScript æ¨¡çµ„ã€‚</p>
            <ol>
                <li>åœ¨çµ‚ç«¯æ©Ÿä¸­åŸ·è¡Œï¼š<code>npm run dev</code></li>
                <li>åœ¨ç€è¦½å™¨ä¸­è¨ªå•ï¼š<code>http://localhost:3001/test-real-music-arrangement-vite.html</code></li>
                <li>Vite æœƒè‡ªå‹•ç·¨è­¯ TypeScript ä¸¦æä¾›æ¨¡çµ„</li>
            </ol>
        </div>
        
        <div id="moduleStatus" class="section">
            <h2>ğŸ“¦ Module Loading Status</h2>
            <div id="loadingStatus">ğŸ”„ Loading music-arrangement module...</div>
        </div>
        
        <!-- Track Management Section -->
        <div class="section">
            <h2>ğŸ›ï¸ Track Management (Real BC)</h2>
            
            <div class="input-group">
                <input type="text" id="trackName" placeholder="è»Œé“åç¨±" value="My Real Track">
                <select id="trackType">
                    <option value="audio">Audio Track</option>
                    <option value="instrument">MIDI/Instrument Track</option>
                    <option value="bus">Bus Track</option>
                </select>
                <input type="text" id="ownerId" placeholder="æ“æœ‰è€… ID" value="user123">
            </div>
            
            <div class="button-grid">
                <button onclick="createRealTrack()" class="track-button">
                    <span class="emoji">â•</span>å‰µå»ºçœŸå¯¦è»Œé“
                </button>
                <button onclick="getTrackInfo()" class="track-button">
                    <span class="emoji">ğŸ“‹</span>ç²å–è»Œé“è³‡è¨Š
                </button>
                <button onclick="testRealAudio()" class="audio-button">
                    <span class="emoji">ğŸµ</span>æ¸¬è©¦çœŸå¯¦éŸ³é »
                </button>
                <button onclick="getRealSystemStats()" class="track-button">
                    <span class="emoji">ğŸ“Š</span>çœŸå¯¦ç³»çµ±çµ±è¨ˆ
                </button>
            </div>
            
            <div class="track-list" id="realTrackList">
                <!-- çœŸå¯¦è»Œé“åˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
        </div>
        
        <!-- MIDI Section -->
        <div class="section">
            <h2>ğŸ¹ MIDI Operations (Real BC)</h2>
            
            <div class="input-group">
                <input type="text" id="midiTrackId" placeholder="MIDI è»Œé“ ID">
                <input type="number" id="midiNote" placeholder="éŸ³ç¬¦ (60=C4)" value="60" min="0" max="127">
                <input type="number" id="midiVelocity" placeholder="åŠ›åº¦" value="100" min="0" max="127">
                <input type="number" id="midiStartTime" placeholder="é–‹å§‹æ™‚é–“" value="0" step="0.1">
                <input type="number" id="midiDuration" placeholder="æŒçºŒæ™‚é–“" value="1" step="0.1">
            </div>
            
            <div class="button-grid">
                <button onclick="addMidiNote()" class="audio-button">
                    <span class="emoji">ğŸ¹</span>æ·»åŠ  MIDI éŸ³ç¬¦
                </button>
                <button onclick="quantizeMidi()" class="audio-button">
                    <span class="emoji">ğŸ“</span>é‡åŒ– MIDI
                </button>
                <button onclick="transposeMidi()" class="audio-button">
                    <span class="emoji">ğŸµ</span>ç§»èª¿ MIDI
                </button>
                <button onclick="getClipsInTrack()" class="track-button">
                    <span class="emoji">ğŸ“‹</span>ç²å–è»Œé“ç‰‡æ®µ
                </button>
            </div>
        </div>
        
        <!-- Audio Clips Section -->
        <div class="section">
            <h2>ğŸµ Audio Clips (Real BC)</h2>
            
            <div class="input-group">
                <input type="text" id="audioTrackId" placeholder="éŸ³é »è»Œé“ ID">
                <input type="text" id="audioUrl" placeholder="éŸ³é » URL" value="https://example.com/audio.mp3">
                <input type="number" id="audioStartTime" placeholder="é–‹å§‹æ™‚é–“" value="0" step="0.1">
                <input type="number" id="audioDuration" placeholder="æŒçºŒæ™‚é–“" value="5" step="0.1">
            </div>
            
            <div class="button-grid">
                <button onclick="createAudioClip()" class="audio-button">
                    <span class="emoji">ğŸµ</span>å‰µå»ºéŸ³é »ç‰‡æ®µ
                </button>
                <button onclick="setAudioClipGain()" class="audio-button">
                    <span class="emoji">ğŸ›ï¸</span>è¨­å®šéŸ³é »å¢ç›Š
                </button>
            </div>
        </div>
        
        <!-- System Status -->
        <div class="section">
            <h2>ğŸ“Š System Status</h2>
            <button onclick="clearLog()" class="collaboration-button">
                <span class="emoji">ğŸ§¹</span>æ¸…é™¤æ—¥èªŒ
            </button>
            <div class="status" id="status">
                <div>ğŸµ Initializing Real Music Arrangement BC...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // ğŸµ çœŸæ­£ä½¿ç”¨ Music Arrangement BC æ¨¡çµ„ (é€šé Vite)
        
        let musicArrangementService = null;
        let isModuleLoaded = false;
        let currentTrackId = null;
        
        // å˜—è©¦è¼‰å…¥çœŸæ­£çš„æ¨¡çµ„
        async function loadMusicArrangementModule() {
            try {
                log('ğŸ”„ Attempting to load real music-arrangement module through Vite...');
                
                // é€šé Vite å°å…¥ TypeScript æ¨¡çµ„
                const { MusicArrangementContainer, MusicArrangementTypes } = await import('/src/modules/music-arrangement/index.ts');
                
                log('ğŸ“¦ Module imported successfully, creating container...');
                
                // å‰µå»º DI å®¹å™¨ä¸¦ç²å–æœå‹™
                const container = new MusicArrangementContainer();
                log('ğŸ”§ Container created, initializing...');
                
                await container.initialize();
                log('âš™ï¸ Container initialized, getting service...');
                
                musicArrangementService = container.get(MusicArrangementTypes.MusicArrangementService);
                
                isModuleLoaded = true;
                
                document.getElementById('loadingStatus').innerHTML = `
                    <div class="success">
                        âœ… Successfully loaded real Music Arrangement BC!<br>
                        ğŸ“¦ Service: ${musicArrangementService.constructor.name}<br>
                        ğŸµ Ready for real operations<br>
                        ğŸš€ Running through Vite development server
                    </div>
                `;
                
                log('âœ… Real Music Arrangement BC loaded successfully!');
                log('ğŸµ You can now use real track management, MIDI, and audio features');
                
                // æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
                await testBasicFunctionality();
                
            } catch (error) {
                console.error('Failed to load music-arrangement module:', error);
                
                let errorMessage = error.message;
                let suggestions = [];
                
                if (error.message.includes('Failed to fetch')) {
                    suggestions.push('ç¢ºä¿ä½ æ­£åœ¨é€šé Vite é–‹ç™¼ä¼ºæœå™¨è¨ªå•æ­¤é é¢ (http://localhost:3001)');
                    suggestions.push('åŸ·è¡Œ `npm run dev` å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨');
                }
                
                if (error.message.includes('Cannot resolve')) {
                    suggestions.push('æª¢æŸ¥ src/modules/music-arrangement/ ç›®éŒ„æ˜¯å¦å­˜åœ¨');
                    suggestions.push('ç¢ºä¿æ‰€æœ‰ TypeScript æª”æ¡ˆéƒ½å­˜åœ¨ä¸”æ²’æœ‰èªæ³•éŒ¯èª¤');
                }
                
                document.getElementById('loadingStatus').innerHTML = `
                    <div class="error">
                        âŒ Failed to load real Music Arrangement BC<br>
                        ğŸ“ Error: ${errorMessage}<br>
                        ${suggestions.length > 0 ? '<br>ğŸ’¡ å»ºè­°ï¼š<br>' + suggestions.map(s => `â€¢ ${s}`).join('<br>') : ''}
                    </div>
                `;
                
                log(`âŒ Failed to load real module: ${errorMessage}`);
                suggestions.forEach(suggestion => log(`ğŸ’¡ ${suggestion}`));
                
                // æä¾›å‚™ç”¨çš„æ¨¡æ“¬å¯¦ç¾
                await loadFallbackImplementation();
            }
        }
        
        // å‚™ç”¨æ¨¡æ“¬å¯¦ç¾
        async function loadFallbackImplementation() {
            log('ğŸ”„ Loading fallback simulation...');
            
            // ç°¡åŒ–çš„æ¨¡æ“¬æœå‹™
            musicArrangementService = {
                async createTrack(ownerId, type, name) {
                    const trackId = `sim_track_${Date.now()}`;
                    log(`ğŸ“ [SIMULATION] Creating track: ${name} (${type}) for ${ownerId}`);
                    currentTrackId = trackId;
                    return trackId;
                },
                
                async getTrackInfo(trackId) {
                    log(`ğŸ“‹ [SIMULATION] Getting track info for ${trackId}`);
                    return {
                        trackId,
                        name: 'Simulated Track',
                        type: 'audio',
                        ownerId: 'user123',
                        status: 'active',
                        clipCount: 0
                    };
                },
                
                async getSystemStats() {
                    log('ğŸ“Š [SIMULATION] Getting system stats');
                    return {
                        trackCount: 1,
                        clipCount: 0,
                        isSimulation: true
                    };
                },
                
                async createMidiClip(trackId, timeRange, instrument, name) {
                    log(`ğŸ¹ [SIMULATION] Creating MIDI clip ${name} in track ${trackId}`);
                    return `sim_midi_clip_${Date.now()}`;
                },
                
                async addMidiNote(trackId, clipId, pitch, velocity, timeRange) {
                    log(`ğŸ¹ [SIMULATION] Adding MIDI note ${pitch} to clip ${clipId} in track ${trackId}`);
                    return `sim_note_${Date.now()}`;
                },
                
                async quantizeMidiClip(trackId, clipId, quantizeValue) {
                    log(`ğŸ“ [SIMULATION] Quantizing MIDI clip ${clipId} in track ${trackId}`);
                    return { success: true, simulation: true };
                },
                
                async transposeMidiClip(trackId, clipId, semitones) {
                    log(`ğŸµ [SIMULATION] Transposing MIDI clip ${clipId} by ${semitones} semitones`);
                    return { success: true, simulation: true };
                },
                
                async createAudioClip(trackId, timeRange, audioSource, name) {
                    log(`ğŸµ [SIMULATION] Creating audio clip ${name} in track ${trackId}`);
                    return `sim_audio_clip_${Date.now()}`;
                },
                
                async getClipsInTrack(trackId) {
                    log(`ğŸ“‹ [SIMULATION] Getting clips in track ${trackId}`);
                    return [
                        {
                            id: 'sim_clip_1',
                            name: 'Simulated Clip',
                            type: 'midi',
                            startTime: 0,
                            endTime: 4,
                            duration: 4
                        }
                    ];
                }
            };
            
            document.getElementById('loadingStatus').innerHTML += `
                <div class="warning">
                    ğŸ”„ Using fallback simulation mode<br>
                    âš ï¸ This is not the real Music Arrangement BC<br>
                    ğŸ’¡ Start Vite dev server to use real module
                </div>
            `;
            
            log('ğŸ”„ Fallback simulation loaded');
        }
        
        // æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
        async function testBasicFunctionality() {
            try {
                log('ğŸ§ª Testing basic functionality...');
                
                // æ¸¬è©¦ç³»çµ±çµ±è¨ˆ
                const stats = await musicArrangementService.getSystemStats();
                log(`ğŸ“Š System stats: ${JSON.stringify(stats)}`);
                
                log('âœ… Basic functionality test passed!');
                
            } catch (error) {
                log(`âŒ Basic functionality test failed: ${error.message}`);
            }
        }
        
        // UI å‡½æ•¸ - ä½¿ç”¨çœŸæ­£çš„æœå‹™
        window.createRealTrack = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            const name = document.getElementById('trackName').value;
            const type = document.getElementById('trackType').value;
            const ownerId = document.getElementById('ownerId').value;
            
            try {
                const trackId = await musicArrangementService.createTrack(ownerId, type, name);
                currentTrackId = trackId;
                log(`âœ… Track created with ID: ${trackId}`);
                
                // è‡ªå‹•å¡«å…¥è»Œé“ ID åˆ°å…¶ä»–æ¬„ä½
                document.getElementById('midiTrackId').value = trackId;
                document.getElementById('audioTrackId').value = trackId;
                
                // æ›´æ–°è»Œé“åˆ—è¡¨
                updateTrackDisplay(trackId, name, type, ownerId);
                
            } catch (error) {
                log(`âŒ Error creating track: ${error.message}`);
            }
        };
        
        window.getTrackInfo = async function() {
            if (!musicArrangementService || !currentTrackId) {
                log('âŒ No track available or service not loaded');
                return;
            }
            
            try {
                const trackInfo = await musicArrangementService.getTrackInfo(currentTrackId);
                log(`ğŸ“‹ Track info: ${JSON.stringify(trackInfo, null, 2)}`);
            } catch (error) {
                log(`âŒ Error getting track info: ${error.message}`);
            }
        };
        
        window.testRealAudio = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            try {
                // å¦‚æœæœ‰éŸ³é »æ¸¬è©¦æ–¹æ³•
                if (typeof musicArrangementService.playTestSound === 'function') {
                    await musicArrangementService.playTestSound();
                    log('ğŸµ Playing test sound through real service');
                } else {
                    log('ğŸµ Audio test method not available in current service');
                    log('ğŸ’¡ Try creating an audio clip and playing it');
                }
            } catch (error) {
                log(`âŒ Error testing audio: ${error.message}`);
            }
        };
        
        window.getRealSystemStats = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            try {
                const stats = await musicArrangementService.getSystemStats();
                log(`ğŸ“Š Real system stats: ${JSON.stringify(stats, null, 2)}`);
            } catch (error) {
                log(`âŒ Error getting system stats: ${error.message}`);
            }
        };
        
        window.addMidiNote = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            const trackId = document.getElementById('midiTrackId').value;
            const note = parseInt(document.getElementById('midiNote').value);
            const velocity = parseInt(document.getElementById('midiVelocity').value);
            const startTime = parseFloat(document.getElementById('midiStartTime').value);
            const duration = parseFloat(document.getElementById('midiDuration').value);
            
            if (!trackId) {
                log('âŒ Please enter a MIDI track ID or create a track first');
                return;
            }
            
            try {
                // é¦–å…ˆå‰µå»ºä¸€å€‹ MIDI clipï¼ˆå¦‚æœé‚„æ²’æœ‰çš„è©±ï¼‰
                log('ğŸ¹ Creating MIDI clip first...');
                const clipId = await musicArrangementService.createMidiClip(
                    trackId,
                    { startTime: 0, endTime: 16 }, // 16 ç§’çš„ clip
                    { type: 'synth', name: 'Default Synth' },
                    'MIDI Clip 1'
                );
                log(`âœ… MIDI clip created: ${clipId}`);
                
                // ç„¶å¾Œæ·»åŠ  MIDI éŸ³ç¬¦
                const endTime = startTime + duration;
                const result = await musicArrangementService.addMidiNote(
                    trackId, 
                    clipId, 
                    note, 
                    velocity, 
                    { startTime, endTime }
                );
                log(`ğŸ¹ MIDI note added: ${JSON.stringify(result)}`);
            } catch (error) {
                log(`âŒ Error adding MIDI note: ${error.message}`);
            }
        };
        
        window.quantizeMidi = async function() {
            const trackId = document.getElementById('midiTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter a MIDI track ID');
                return;
            }
            
            try {
                // ç²å–è»Œé“ä¸­çš„ clips
                const clips = await musicArrangementService.getClipsInTrack(trackId);
                if (clips.length === 0) {
                    log('âŒ No clips found in track. Create a MIDI clip first.');
                    return;
                }
                
                const clipId = clips[0].id; // ä½¿ç”¨ç¬¬ä¸€å€‹ clip
                const result = await musicArrangementService.quantizeMidiClip(trackId, clipId, '1/16'); // 16th note quantization
                log(`ğŸ“ MIDI quantized: ${JSON.stringify(result)}`);
            } catch (error) {
                log(`âŒ Error quantizing MIDI: ${error.message}`);
            }
        };
        
        window.transposeMidi = async function() {
            const trackId = document.getElementById('midiTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter a MIDI track ID');
                return;
            }
            
            try {
                // ç²å–è»Œé“ä¸­çš„ clips
                const clips = await musicArrangementService.getClipsInTrack(trackId);
                if (clips.length === 0) {
                    log('âŒ No clips found in track. Create a MIDI clip first.');
                    return;
                }
                
                const clipId = clips[0].id; // ä½¿ç”¨ç¬¬ä¸€å€‹ clip
                const result = await musicArrangementService.transposeMidiClip(trackId, clipId, 2); // Transpose up 2 semitones
                log(`ğŸµ MIDI transposed: ${JSON.stringify(result)}`);
            } catch (error) {
                log(`âŒ Error transposing MIDI: ${error.message}`);
            }
        };
        
        window.createAudioClip = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            const trackId = document.getElementById('audioTrackId').value;
            const audioUrl = document.getElementById('audioUrl').value;
            const startTime = parseFloat(document.getElementById('audioStartTime').value);
            const duration = parseFloat(document.getElementById('audioDuration').value);
            
            if (!trackId) {
                log('âŒ Please enter an audio track ID or create a track first');
                return;
            }
            
            try {
                const endTime = startTime + duration;
                const result = await musicArrangementService.createAudioClip(
                    trackId,
                    { startTime, endTime },
                    { url: audioUrl, name: 'Audio Sample' },
                    'Audio Clip 1'
                );
                log(`ğŸµ Audio clip created: ${JSON.stringify(result)}`);
            } catch (error) {
                log(`âŒ Error creating audio clip: ${error.message}`);
            }
        };
        
        window.getClipsInTrack = async function() {
            const trackId = document.getElementById('midiTrackId').value || document.getElementById('audioTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter a track ID');
                return;
            }
            
            try {
                const clips = await musicArrangementService.getClipsInTrack(trackId);
                log(`ğŸ“‹ Track clips: ${JSON.stringify(clips, null, 2)}`);
            } catch (error) {
                log(`âŒ Error getting track clips: ${error.message}`);
            }
        };
        
        window.setAudioClipGain = async function() {
            const trackId = document.getElementById('audioTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter an audio track ID');
                return;
            }
            
            try {
                // å‡è¨­æœ‰éŸ³é »ç‰‡æ®µï¼Œè¨­å®šå¢ç›Šç‚º 0.8
                const result = await musicArrangementService.setAudioClipGain(trackId, 'clip_1', 0.8);
                log(`ğŸ›ï¸ Audio clip gain set: ${JSON.stringify(result)}`);
            } catch (error) {
                log(`âŒ Error setting audio clip gain: ${error.message}`);
            }
        };
        
        window.clearLog = function() {
            document.getElementById('status').innerHTML = '<div>ğŸµ Log cleared</div>';
        };
        
        // æ›´æ–°è»Œé“é¡¯ç¤º
        function updateTrackDisplay(trackId, name, type, ownerId) {
            const trackListDiv = document.getElementById('realTrackList');
            
            trackListDiv.innerHTML = `
                <div class="track-card">
                    <div class="track-header">
                        <strong>${name}</strong>
                        <span class="track-controls">
                            <button class="small-button" onclick="selectTrack('${trackId}')">é¸æ“‡</button>
                        </span>
                    </div>
                    <div>ID: ${trackId}</div>
                    <div>Type: ${type}</div>
                    <div>Owner: ${ownerId}</div>
                    <div>Status: active</div>
                </div>
            `;
        }
        
        window.selectTrack = function(trackId) {
            document.getElementById('midiTrackId').value = trackId;
            document.getElementById('audioTrackId').value = trackId;
            currentTrackId = trackId;
            log(`âœ… Selected track: ${trackId}`);
        };
        
        // æ—¥èªŒå‡½æ•¸
        function log(message) {
            const statusDiv = document.getElementById('status');
            const time = new Date().toLocaleTimeString();
            statusDiv.innerHTML += `<div>[${time}] ${message}</div>`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        // æª¢æŸ¥æ˜¯å¦åœ¨ Vite é–‹ç™¼ç’°å¢ƒä¸­
        function checkViteEnvironment() {
            const isVite = window.location.protocol === 'http:' && 
                          (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1');
            
            if (!isVite) {
                document.getElementById('loadingStatus').innerHTML = `
                    <div class="warning">
                        âš ï¸ ä¸åœ¨ Vite é–‹ç™¼ç’°å¢ƒä¸­<br>
                        ğŸ’¡ è«‹åŸ·è¡Œ \`npm run dev\` ä¸¦é€šé http://localhost:3001 è¨ªå•æ­¤é é¢
                    </div>
                `;
                log('âš ï¸ Not running in Vite development environment');
                log('ğŸ’¡ Please run `npm run dev` and access via http://localhost:3001');
                return false;
            }
            
            return true;
        }
        
        // åˆå§‹åŒ–
        log('ğŸµ Starting Real Music Arrangement BC Test (Vite)...');
        
        if (checkViteEnvironment()) {
            loadMusicArrangementModule();
        } else {
            setTimeout(loadFallbackImplementation, 1000);
        }
    </script>
</body>
</html> 