<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ Real Music Arrangement BC Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            margin-top: 0;
            color: #ffd700;
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
            padding-bottom: 10px;
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            border: none;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .track-button {
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
        }
        
        .collaboration-button {
            background: linear-gradient(45deg, #a8edea, #fed6e3);
            color: #333;
        }
        
        .audio-button {
            background: linear-gradient(45deg, #ffeaa7, #fab1a0);
            color: #333;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            align-items: center;
        }
        
        input, select {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .status {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .track-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .track-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .track-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .track-controls {
            display: flex;
            gap: 5px;
        }
        
        .small-button {
            padding: 5px 10px;
            font-size: 12px;
            min-width: auto;
        }
        
        .error {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .success {
            background: rgba(0, 255, 0, 0.2);
            border: 1px solid rgba(0, 255, 0, 0.5);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .emoji {
            font-size: 1.2em;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸµ Real Music Arrangement BC Test</h1>
        
        <div id="moduleStatus" class="section">
            <h2>ğŸ“¦ Module Loading Status</h2>
            <div id="loadingStatus">ğŸ”„ Loading music-arrangement module...</div>
        </div>
        
        <!-- Track Management Section -->
        <div class="section">
            <h2>ğŸ›ï¸ Track Management (Real BC)</h2>
            
            <div class="input-group">
                <input type="text" id="trackName" placeholder="è»Œé“åç¨±" value="My Real Track">
                <select id="trackType">
                    <option value="audio">Audio Track</option>
                    <option value="midi">MIDI Track</option>
                </select>
                <input type="text" id="ownerId" placeholder="æ“æœ‰è€… ID" value="user123">
            </div>
            
            <div class="button-grid">
                <button onclick="createRealTrack()" class="track-button">
                    <span class="emoji">â•</span>å‰µå»ºçœŸå¯¦è»Œé“
                </button>
                <button onclick="getAllRealTracks()" class="track-button">
                    <span class="emoji">ğŸ“‹</span>ç²å–æ‰€æœ‰è»Œé“
                </button>
                <button onclick="testRealAudio()" class="audio-button">
                    <span class="emoji">ğŸµ</span>æ¸¬è©¦çœŸå¯¦éŸ³é »
                </button>
                <button onclick="getRealSystemStats()" class="track-button">
                    <span class="emoji">ğŸ“Š</span>çœŸå¯¦ç³»çµ±çµ±è¨ˆ
                </button>
            </div>
            
            <div class="track-list" id="realTrackList">
                <!-- çœŸå¯¦è»Œé“åˆ—è¡¨å°‡åœ¨é€™è£¡é¡¯ç¤º -->
            </div>
        </div>
        
        <!-- MIDI Section -->
        <div class="section">
            <h2>ğŸ¹ MIDI Operations (Real BC)</h2>
            
            <div class="input-group">
                <input type="text" id="midiTrackId" placeholder="MIDI è»Œé“ ID">
                <input type="number" id="midiNote" placeholder="éŸ³ç¬¦ (60=C4)" value="60" min="0" max="127">
                <input type="number" id="midiVelocity" placeholder="åŠ›åº¦" value="100" min="0" max="127">
                <input type="number" id="midiStartTime" placeholder="é–‹å§‹æ™‚é–“" value="0" step="0.1">
                <input type="number" id="midiDuration" placeholder="æŒçºŒæ™‚é–“" value="1" step="0.1">
            </div>
            
            <div class="button-grid">
                <button onclick="addMidiNote()" class="audio-button">
                    <span class="emoji">ğŸ¹</span>æ·»åŠ  MIDI éŸ³ç¬¦
                </button>
                <button onclick="quantizeMidi()" class="audio-button">
                    <span class="emoji">ğŸ“</span>é‡åŒ– MIDI
                </button>
                <button onclick="transposeMidi()" class="audio-button">
                    <span class="emoji">ğŸµ</span>ç§»èª¿ MIDI
                </button>
            </div>
        </div>
        
        <!-- Audio Clips Section -->
        <div class="section">
            <h2>ğŸµ Audio Clips (Real BC)</h2>
            
            <div class="input-group">
                <input type="text" id="audioTrackId" placeholder="éŸ³é »è»Œé“ ID">
                <input type="text" id="audioUrl" placeholder="éŸ³é » URL" value="https://example.com/audio.mp3">
                <input type="number" id="audioStartTime" placeholder="é–‹å§‹æ™‚é–“" value="0" step="0.1">
                <input type="number" id="audioDuration" placeholder="æŒçºŒæ™‚é–“" value="5" step="0.1">
            </div>
            
            <div class="button-grid">
                <button onclick="createAudioClip()" class="audio-button">
                    <span class="emoji">ğŸµ</span>å‰µå»ºéŸ³é »ç‰‡æ®µ
                </button>
                <button onclick="getTrackClips()" class="track-button">
                    <span class="emoji">ğŸ“‹</span>ç²å–è»Œé“ç‰‡æ®µ
                </button>
            </div>
        </div>
        
        <!-- System Status -->
        <div class="section">
            <h2>ğŸ“Š System Status</h2>
            <button onclick="clearLog()" class="collaboration-button">
                <span class="emoji">ğŸ§¹</span>æ¸…é™¤æ—¥èªŒ
            </button>
            <div class="status" id="status">
                <div>ğŸµ Initializing Real Music Arrangement BC...</div>
            </div>
        </div>
    </div>

    <script type="module">
        // ğŸµ çœŸæ­£ä½¿ç”¨ Music Arrangement BC æ¨¡çµ„
        
        let musicArrangementService = null;
        let isModuleLoaded = false;
        
        // å˜—è©¦è¼‰å…¥çœŸæ­£çš„æ¨¡çµ„
        async function loadMusicArrangementModule() {
            try {
                log('ğŸ”„ Attempting to load real music-arrangement module...');
                
                // å˜—è©¦å°å…¥çœŸæ­£çš„æ¨¡çµ„
                const { MusicArrangementContainer, MusicArrangementTypes } = await import('./src/modules/music-arrangement/index.js');
                
                // å‰µå»º DI å®¹å™¨ä¸¦ç²å–æœå‹™
                const container = new MusicArrangementContainer();
                await container.initialize();
                musicArrangementService = container.get(MusicArrangementTypes.MusicArrangementService);
                
                isModuleLoaded = true;
                
                document.getElementById('loadingStatus').innerHTML = `
                    <div class="success">
                        âœ… Successfully loaded real Music Arrangement BC!<br>
                        ğŸ“¦ Service: ${musicArrangementService.constructor.name}<br>
                        ğŸµ Ready for real operations
                    </div>
                `;
                
                log('âœ… Real Music Arrangement BC loaded successfully!');
                log('ğŸµ You can now use real track management, MIDI, and audio features');
                
                // æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
                await testBasicFunctionality();
                
            } catch (error) {
                console.error('Failed to load music-arrangement module:', error);
                
                document.getElementById('loadingStatus').innerHTML = `
                    <div class="error">
                        âŒ Failed to load real Music Arrangement BC<br>
                        ğŸ“ Error: ${error.message}<br>
                        ğŸ’¡ Make sure the module files exist in src/modules/music-arrangement/
                    </div>
                `;
                
                log(`âŒ Failed to load real module: ${error.message}`);
                log('ğŸ’¡ This page requires the actual music-arrangement module files');
                
                // æä¾›å‚™ç”¨çš„æ¨¡æ“¬å¯¦ç¾
                await loadFallbackImplementation();
            }
        }
        
        // å‚™ç”¨æ¨¡æ“¬å¯¦ç¾
        async function loadFallbackImplementation() {
            log('ğŸ”„ Loading fallback simulation...');
            
            // ç°¡åŒ–çš„æ¨¡æ“¬æœå‹™
            musicArrangementService = {
                async createTrack(name, type, ownerId) {
                    log(`ğŸ“ [SIMULATION] Creating track: ${name} (${type}) for ${ownerId}`);
                    return {
                        trackId: `sim_track_${Date.now()}`,
                        name,
                        type,
                        ownerId,
                        status: 'active'
                    };
                },
                
                async getSystemStats() {
                    log('ğŸ“Š [SIMULATION] Getting system stats');
                    return {
                        trackCount: 0,
                        clipCount: 0,
                        isSimulation: true
                    };
                },
                
                async addMidiNote(trackId, note, velocity, startTime, duration) {
                    log(`ğŸ¹ [SIMULATION] Adding MIDI note ${note} to track ${trackId}`);
                    return { success: true, simulation: true };
                },
                
                async createAudioClip(trackId, audioUrl, startTime, duration) {
                    log(`ğŸµ [SIMULATION] Creating audio clip in track ${trackId}`);
                    return { 
                        clipId: `sim_clip_${Date.now()}`,
                        trackId,
                        audioUrl,
                        startTime,
                        duration
                    };
                }
            };
            
            document.getElementById('loadingStatus').innerHTML += `
                <div class="error">
                    ğŸ”„ Using fallback simulation mode<br>
                    âš ï¸ This is not the real Music Arrangement BC
                </div>
            `;
            
            log('ğŸ”„ Fallback simulation loaded');
        }
        
        // æ¸¬è©¦åŸºæœ¬åŠŸèƒ½
        async function testBasicFunctionality() {
            try {
                log('ğŸ§ª Testing basic functionality...');
                
                // æ¸¬è©¦ç³»çµ±çµ±è¨ˆ
                const stats = await musicArrangementService.getSystemStats();
                log(`ğŸ“Š System stats: ${JSON.stringify(stats)}`);
                
                log('âœ… Basic functionality test passed!');
                
            } catch (error) {
                log(`âŒ Basic functionality test failed: ${error.message}`);
            }
        }
        
        // UI å‡½æ•¸ - ä½¿ç”¨çœŸæ­£çš„æœå‹™
        window.createRealTrack = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            const name = document.getElementById('trackName').value;
            const type = document.getElementById('trackType').value;
            const ownerId = document.getElementById('ownerId').value;
            
            try {
                const result = await musicArrangementService.createTrack(name, type, ownerId);
                log(`âœ… Track created: ${JSON.stringify(result)}`);
                
                // æ›´æ–°è»Œé“åˆ—è¡¨
                updateRealTrackList();
                
            } catch (error) {
                log(`âŒ Error creating track: ${error.message}`);
            }
        };
        
        window.getAllRealTracks = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            try {
                // å¦‚æœæœ‰ getAllTracks æ–¹æ³•
                if (typeof musicArrangementService.getAllTracks === 'function') {
                    const tracks = await musicArrangementService.getAllTracks();
                    log(`ğŸ“‹ Retrieved ${tracks.length} tracks`);
                    updateRealTrackList(tracks);
                } else {
                    log('ğŸ“‹ getAllTracks method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error getting tracks: ${error.message}`);
            }
        };
        
        window.testRealAudio = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            try {
                // å¦‚æœæœ‰éŸ³é »æ¸¬è©¦æ–¹æ³•
                if (typeof musicArrangementService.playTestSound === 'function') {
                    await musicArrangementService.playTestSound();
                    log('ğŸµ Playing test sound through real service');
                } else {
                    log('ğŸµ Audio test method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error testing audio: ${error.message}`);
            }
        };
        
        window.getRealSystemStats = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            try {
                const stats = await musicArrangementService.getSystemStats();
                log(`ğŸ“Š Real system stats: ${JSON.stringify(stats, null, 2)}`);
            } catch (error) {
                log(`âŒ Error getting system stats: ${error.message}`);
            }
        };
        
        window.addMidiNote = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            const trackId = document.getElementById('midiTrackId').value;
            const note = parseInt(document.getElementById('midiNote').value);
            const velocity = parseInt(document.getElementById('midiVelocity').value);
            const startTime = parseFloat(document.getElementById('midiStartTime').value);
            const duration = parseFloat(document.getElementById('midiDuration').value);
            
            if (!trackId) {
                log('âŒ Please enter a MIDI track ID');
                return;
            }
            
            try {
                if (typeof musicArrangementService.addMidiNote === 'function') {
                    const result = await musicArrangementService.addMidiNote(trackId, note, velocity, startTime, duration);
                    log(`ğŸ¹ MIDI note added: ${JSON.stringify(result)}`);
                } else {
                    log('ğŸ¹ addMidiNote method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error adding MIDI note: ${error.message}`);
            }
        };
        
        window.quantizeMidi = async function() {
            const trackId = document.getElementById('midiTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter a MIDI track ID');
                return;
            }
            
            try {
                if (typeof musicArrangementService.quantizeMidi === 'function') {
                    const result = await musicArrangementService.quantizeMidi(trackId, 0.25); // 16th note quantization
                    log(`ğŸ“ MIDI quantized: ${JSON.stringify(result)}`);
                } else {
                    log('ğŸ“ quantizeMidi method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error quantizing MIDI: ${error.message}`);
            }
        };
        
        window.transposeMidi = async function() {
            const trackId = document.getElementById('midiTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter a MIDI track ID');
                return;
            }
            
            try {
                if (typeof musicArrangementService.transposeMidi === 'function') {
                    const result = await musicArrangementService.transposeMidi(trackId, 2); // Transpose up 2 semitones
                    log(`ğŸµ MIDI transposed: ${JSON.stringify(result)}`);
                } else {
                    log('ğŸµ transposeMidi method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error transposing MIDI: ${error.message}`);
            }
        };
        
        window.createAudioClip = async function() {
            if (!musicArrangementService) {
                log('âŒ Music Arrangement Service not loaded');
                return;
            }
            
            const trackId = document.getElementById('audioTrackId').value;
            const audioUrl = document.getElementById('audioUrl').value;
            const startTime = parseFloat(document.getElementById('audioStartTime').value);
            const duration = parseFloat(document.getElementById('audioDuration').value);
            
            if (!trackId) {
                log('âŒ Please enter an audio track ID');
                return;
            }
            
            try {
                if (typeof musicArrangementService.createAudioClip === 'function') {
                    const result = await musicArrangementService.createAudioClip(trackId, audioUrl, startTime, duration);
                    log(`ğŸµ Audio clip created: ${JSON.stringify(result)}`);
                } else {
                    log('ğŸµ createAudioClip method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error creating audio clip: ${error.message}`);
            }
        };
        
        window.getTrackClips = async function() {
            const trackId = document.getElementById('audioTrackId').value;
            
            if (!trackId) {
                log('âŒ Please enter a track ID');
                return;
            }
            
            try {
                if (typeof musicArrangementService.getClipsInTrack === 'function') {
                    const clips = await musicArrangementService.getClipsInTrack(trackId);
                    log(`ğŸ“‹ Track clips: ${JSON.stringify(clips, null, 2)}`);
                } else {
                    log('ğŸ“‹ getClipsInTrack method not available in current service');
                }
            } catch (error) {
                log(`âŒ Error getting track clips: ${error.message}`);
            }
        };
        
        window.clearLog = function() {
            document.getElementById('status').innerHTML = '<div>ğŸµ Log cleared</div>';
        };
        
        // æ›´æ–°è»Œé“åˆ—è¡¨
        function updateRealTrackList(tracks = []) {
            const trackListDiv = document.getElementById('realTrackList');
            
            if (tracks.length === 0) {
                trackListDiv.innerHTML = '<div>No tracks available</div>';
                return;
            }
            
            trackListDiv.innerHTML = tracks.map(track => `
                <div class="track-card">
                    <div class="track-header">
                        <strong>${track.name}</strong>
                        <span class="track-controls">
                            <button class="small-button" onclick="selectTrack('${track.trackId}')">é¸æ“‡</button>
                        </span>
                    </div>
                    <div>ID: ${track.trackId}</div>
                    <div>Type: ${track.type}</div>
                    <div>Owner: ${track.ownerId}</div>
                    <div>Status: ${track.status}</div>
                </div>
            `).join('');
        }
        
        window.selectTrack = function(trackId) {
            document.getElementById('midiTrackId').value = trackId;
            document.getElementById('audioTrackId').value = trackId;
            log(`âœ… Selected track: ${trackId}`);
        };
        
        // æ—¥èªŒå‡½æ•¸
        function log(message) {
            const statusDiv = document.getElementById('status');
            const time = new Date().toLocaleTimeString();
            statusDiv.innerHTML += `<div>[${time}] ${message}</div>`;
            statusDiv.scrollTop = statusDiv.scrollHeight;
        }
        
        // åˆå§‹åŒ–
        log('ğŸµ Starting Real Music Arrangement BC Test...');
        loadMusicArrangementModule();
    </script>
</body>
</html> 